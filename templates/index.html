<!DOCTYPE html>
<html>
<head>
    <title>OCPP CMS Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', path='styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>OCPP CMS Dashboard</h1>
        
        <div class="stations-container">
            <h2>Charging Stations</h2>
            <table class="stations-table">
                <thead>
                    <tr>
                        <th>Station ID</th>
                        <th>Status</th>
                        <th>Last Heartbeat</th>
                        <th>Current Power (kW)</th>
                        <th>Total Energy (kWh)</th>
                        <th>Vendor</th>
                        <th>Model</th>
                    </tr>
                </thead>
                <tbody>
                    {% for station in stations %}
                    <tr>
                        <td>{{ station.station_id }}</td>
                        <td class="status-{{ station.status.lower() }}">{{ station.status }}</td>
                        <td>{{ station.last_heartbeat.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                        <td>{{ station.current_power|round(2) }}</td>
                        <td>{{ station.total_energy_consumed|round(2) }}</td>
                        <td>{{ station.vendor }}</td>
                        <td>{{ station.model }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="transactions-container">
            <h2>Active Transactions</h2>
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>Transaction ID</th>
                        <th>Station ID</th>
                        <th>Start Time</th>
                        <th>Energy Consumed (kWh)</th>
                        <th>Max Power (kW)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in transactions %}
                    <tr>
                        <td>{{ transaction.transaction_id }}</td>
                        <td>{{ transaction.station_id }}</td>
                        <td>{{ transaction.start_time.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                        <td>{{ transaction.energy_consumed|round(2) }}</td>
                        <td>{{ transaction.max_power|round(2) }}</td>
                        <td>
                            <button onclick="stopTransaction('{{ transaction.transaction_id }}')">Stop Transaction</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
    function stopTransaction(transactionId) {
        axios.post(`/stop-transaction/${transactionId}`)
            .then(response => {
                alert('Transaction stopped successfully');
                location.reload();
            })
            .catch(error => {
                alert('Failed to stop transaction: ' + error.response.data.message);
            });
    }
    </script>
</body>
</html>